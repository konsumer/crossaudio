<head>
  <title>crossaudio spectrograph</title>
</head>

<body>
  <canvas></canvas>
  <input type="range" min="65" max="865">

  <!-- I'm not using a bundler or anything! -->
  <script type="importmap">
  {
    "imports": {
      "@crossaudio/core": "https://unpkg.com/@crossaudio/core@0.0.3/index.js",
      "emitonoff": "https://unpkg.com/emitonoff@0.1.0/index.js",
      "@web-audio-components/spectrograph": "NOT SETUP YET"
    }
  }
  </script>
  <script type="module">
import { play, Params } from '@crossaudio/core'
import Spectrograph from '@web-audio-components/spectrograph'

const canvas = document.getElementsByTag('canvas')[0]
const freq = document.getElementsByTag('input')[0]

function synth(context, params) {
  // setup visualization
  const buffer = context.createBufferSource()
  const spec = new Spectrograph(context, { canvas })

  // make an oscillator
  const vco = context.createOscillator()
  vco.frequency.value = params.frequency
  vco.start()
  
  // respond to changes of frequency
  params.on('frequency', newFrequency => {
    vco.frequency.value = newFrequency
  })

  // connect oscillator to buffer, buffer to viz & viz to output
  vco.connect(buffer)
  buffer.connect(spec)
  spec.connect(context.destination)
}

// setup initial params
const p = new Params({
  frequency: 440
})

// periodically update the frequency slider, every second
setInterval(() => {
  freq.value = 65 + (Math.random() * 800)
}, 1000)

play(synth, p)

// on chnage, update the param
freq.addEventListener('change', e => {
  p.frequency = freq.value
})
</script>
</body>